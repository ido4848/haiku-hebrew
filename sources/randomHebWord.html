<html>
<head>
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
<meta http-equiv="pragma" content="no-cache" />
</head>
<body>
<script>

function parse_data(data) {
	var word = {};
	var str = data.data;

	var hebword = str.replace(/[\s\S]*<title>(.*) - [\s\S]*/g, "$1");
	console.log(hebword);
	word.hebword = hebword;

	var type = str.replace(/[\s\S]*<b>חלק דיבר<\/b><\/td>\n<td>(.*?)<\/td>[\s\S]*/g, "$1");
	if (type == "שם־עצם") word.type = "shem";
	else if (type == "שם-תואר") word.type = "adje";
	else if (type == "פעל") word.type = "verb"; // fuck. this never happens.
	else {		
		// Bad word
		console.log("HERE3");
		getWord(word_callback);
		return;
	}
	
	if (str.match("<b>מין<\/b><\/td>\n<td>זכר<\/td>")) word.sex = "male";
	else if (str.match("<b>מין<\/b><\/td>\n<td>נקבה<\/td>")) word.sex = "female";
	else {
		// Bad word
		console.log("HERE4");
		getWord(word_callback);
		return;
	}

	var pronounciation = str.replace(/[\s\S]*הגייה[\s\S]*?ltr;">([\s\S]*?)<\/td>[\s\S]*/g, "$1");
	pronounciation = pronounciation.replace(/,.*/g, "");

	if (pronounciation.match(/^<!DOCTYPE/)) {
		// Bad word
		console.log("HERE1");
		getWord(word_callback);
		return;
	}
	pronounciation = pronounciation.replace(/<.*?>/g, "");
	if (pronounciation.replace(/\s/g, "") == "") {
		// Bad word
		console.log("HERE2");
		getWord(word_callback);
		return;
	}
	word.pronounciation = pronounciation;

	var plural = str.replace(/[\s\S]*נטיות<\/b><\/td>\n<td>ר' ([\S]*)[\s\S]*/g, "$1");
	plural = plural.replace(/[^אבגדהוזחיטכלמנסעפצקרשתםןץף]/g, "");
	if (plural.length > 0 && plural.length < 15)
		word.plural = plural;

	word_callback(word);	
}

var word_callback;
function getWord(callback) {
	word_callback = callback;

	// activate jsonp
	script = document.createElement('script');
	script.src = 'http://jsonp.afeld.me/?callback=parse_data&url=https%3A%2F%2Fhe.wiktionary.org%2Fwiki%2F%25D7%259E%25D7%2599%25D7%2595%25D7%2597%25D7%2593%3A%25D7%2590%25D7%25A7%25D7%25A8%25D7%2590%25D7%2599';
	script.src += '&version=' + Math.random(); // prevent caching

	document.getElementsByTagName('head')[0].appendChild(script);
}

function printWord(word) {
	console.log(word);
}

getWord(printWord);

</script>
</body>
<html>
